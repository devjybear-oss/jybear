<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FileVault ‚Äî ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ü‡∏•‡πå (Standalone)</title>
  <style>
    :root{
      --bg:#0f1220;--panel:#151935;--panel-2:#1b2042;--muted:#8b93b7;--text:#e7ebff;--primary:#6ea8ff;--accent:#7ef1c5;--danger:#ff6b6b;
      --radius:14px;--shadow:0 10px 30px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#10142a,#0a0d1c); color:var(--text)}
    button,input,select{font:inherit;color:inherit}
    a{color:var(--primary)}

    /* Layout */
    .app{display:grid; grid-template-columns: 320px 1fr; gap:18px; padding:18px; height:100dvh; max-width: 1400px; margin:0 auto;}
    .card{background:linear-gradient(180deg,var(--panel),var(--panel-2)); border-radius:var(--radius); box-shadow:var(--shadow); border:1px solid rgba(255,255,255,.06); min-width:0; min-height:0}

    /* Sidebar */
    .sidebar{display:flex; flex-direction:column; padding:16px; overflow:auto}
    .brand{display:flex; align-items:center; gap:10px; margin-bottom:16px}
    .logo{width:36px; height:36px; border-radius:10px; background:radial-gradient(circle at 30% 20%, var(--accent), transparent 40%),
      radial-gradient(circle at 70% 80%, var(--primary), transparent 35%),
      linear-gradient(135deg, #1e274d, #131a39); box-shadow:inset 0 0 0 1px rgba(255,255,255,.07)}
    .brand h1{font-size:18px; margin:0}

    .sidebar .actions{display:flex; gap:8px; margin:10px 0 16px; flex-wrap:wrap}
    .btn{background:#23284f; border:1px solid rgba(255,255,255,.08); border-radius:10px; padding:8px 10px; cursor:pointer; transition:transform .05s ease, background .2s}
    .btn:hover{background:#2a2f5a}
    .btn.primary{background:linear-gradient(180deg,#3d68ff,#3656d6); border:1px solid rgba(0,0,0,.2)}
    .btn.danger{background:linear-gradient(180deg,#ff5a5a,#e04848); border:1px solid rgba(0,0,0,.2)}

    .search{display:flex; gap:8px; background:#1a1f41; border:1px solid rgba(255,255,255,.06); border-radius:12px; padding:8px 10px; align-items:center}
    .search input{flex:1; background:transparent; border:0; outline:0}

    .cat-list{margin-top:14px; overflow:auto; min-height:0}
    .cat{display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px; cursor:pointer; border:1px solid transparent}
    .cat:hover{background:#1c2146}
    .cat.active{background:#202657; border-color:#2e3a7c}
    .cat .name{flex:1; font-weight:600}
    .cat .count{font-size:12px; color:var(--muted)}
    .cat .actions{display:flex; gap:6px}
    .icon-btn{background:transparent; border:0; color:var(--muted); cursor:pointer}
    .icon-btn:hover{color:var(--text)}

    /* Main */
    .main{display:flex; flex-direction:column; padding:16px; overflow:hidden}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; align-items:center; position:sticky; top:0; z-index:1; padding-bottom:10px; background:linear-gradient(180deg,var(--panel),rgba(0,0,0,0));}
    .toolbar .grow{flex:1; min-width:200px}
    .badge{padding:6px 10px; border:1px solid rgba(255,255,255,.08); border-radius:20px; color:var(--muted)}

    .filters{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    .chip{font-size:12px; padding:6px 10px; border-radius:20px; border:1px dashed rgba(255,255,255,.16); color:#b7c0f8; cursor:default}
    .chip.tag{border-style:solid; cursor:pointer}
    .chip.tag.active{background:#2a326b}

    .grid{margin-top:14px; display:grid; grid-template-columns: repeat( auto-fill, minmax(260px, 1fr) ); gap:12px; overflow:auto; padding-bottom:10px}

    .file{display:flex; gap:12px; align-items:flex-start; padding:12px; border-radius:12px; border:1px solid rgba(255,255,255,.06); background:#14193a; min-width:0}
    .file .thumb{width:44px; height:44px; border-radius:10px; background:#222757; display:grid; place-items:center; font-size:22px; flex:0 0 44px}
    .file .meta{flex:1; min-width:0}
    .file .meta .name{font-weight:700; overflow:hidden; text-overflow:ellipsis; white-space:nowrap}
    .file .meta .sub{color:var(--muted); font-size:12px}
    .file .tags{display:flex; gap:6px; flex-wrap:wrap; margin-top:6px}
    .file .tagchip{font-size:11px; padding:4px 8px; border-radius:14px; border:1px solid rgba(255,255,255,.18)}
    .file .file-actions{display:flex; gap:6px; flex-wrap:wrap}

    .empty{opacity:.8; text-align:center; padding:40px}

    .footer{margin-top:auto; display:flex; gap:8px; align-items:center; color:var(--muted); font-size:12px}

    /* Dialog */
    dialog{border:0; border-radius:14px; background:linear-gradient(180deg,#15193a,#121735); color:var(--text); padding:16px; width:min(560px, 92vw)}
    dialog::backdrop{background:rgba(0,0,0,.55)}
    .dialog-actions{display:flex; gap:8px; justify-content:flex-end; margin-top:14px}
    .field{display:flex; flex-direction:column; gap:6px; margin:8px 0}
    .field input, .field select, .field textarea{background:#0f1433; border:1px solid rgba(255,255,255,.08); border-radius:10px; padding:10px}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .row .field{flex:1}

    /* Responsive */
    @media (max-width: 900px){ .app{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar card">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>FileVault</h1>
          <div style="color:var(--muted); font-size:12px">‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå ‚Äî ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="addCatBtn">+ ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
        <button class="btn" id="renameCatBtn">‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™</button>
        <button class="btn danger" id="deleteCatBtn">‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</button>
      </div>

      <div class="search">
        <input id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå/‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å/‡πÅ‡∏ó‡πá‡∏Å‚Ä¶ (‡∏û‡∏¥‡∏°‡∏û‡πå‡πÅ‡∏•‡πâ‡∏ß Enter)" />
        <button class="icon-btn" id="clearSearch" title="‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤">‚úï</button>
      </div>

      <div class="cat-list" id="catList" role="listbox" aria-label="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠"></div>

      <div class="footer">
        <span>‚ö°</span>
        <span>‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏≠‡∏ü‡πÑ‡∏•‡∏ô‡πå | ‡∏™‡∏≥‡∏£‡∏≠‡∏á/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ</span>
      </div>
    </aside>

    <main class="main card" id="dropZone">
      <div class="toolbar">
        <div class="grow">
          <span class="badge" id="currentCatBadge">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: -</span>
        </div>
        <div class="filters">
          <span class="chip">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ó‡πá‡∏Å:</span>
          <div id="tagFilters" class="filters" style="gap:6px"></div>
          <button class="btn" id="clearTagFilterBtn" title="‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏ó‡πá‡∏Å">‡∏•‡πâ‡∏≤‡∏á</button>
        </div>
        <input type="file" id="fileInput" multiple hidden />
        <button class="btn primary" id="addFilesBtn">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå</button>
        <button class="btn" id="newNoteBtn">+ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</button>
        <button class="btn" id="lockToggleBtn" title="‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ">üîí ‡∏•‡πá‡∏≠‡∏Ñ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="btn" id="exportBtn">‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
        <label class="btn" for="importInput">‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</label>
        <input type="file" id="importInput" accept="application/json" hidden />
      </div>

      <div class="grid" id="fileGrid" aria-live="polite"></div>
      <div class="empty" id="emptyState" hidden>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ ‚Äî ‡∏•‡∏≠‡∏á‡∏Ñ‡∏•‡∏¥‡∏Å ‚Äú+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏ü‡∏•‡πå‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏≤‡∏Å‡∏°‡∏≤‡∏ß‡∏≤‡∏á</div>
    </main>
  </div>

  <!-- Dialogs -->
  <dialog id="catDialog">
    <form method="dialog">
      <h3 id="catDialogTitle">‡∏™‡∏£‡πâ‡∏≤‡∏á/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</h3>
      <div class="field">
        <label for="catName">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label>
        <input id="catName" maxlength="120" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£, ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û, ‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå" />
      </div>
      <div class="row">
        <div class="field">
          <label><input type="checkbox" id="catLockEnable" /> ‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
        </div>
      </div>
      <div class="row" id="catLockRow" style="display:none">
        <div class="field">
          <label for="catPassword">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</label>
          <input id="catPassword" type="password" placeholder="‡∏ï‡∏±‡πâ‡∏á/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠" />
        </div>
        <div class="field">
          <label for="catHint">‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
          <input id="catHint" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡πÅ‡∏°‡πà‡∏¢‡πà‡∏≠" />
        </div>
      </div>
      <div class="dialog-actions">
        <button class="btn" value="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn primary" value="ok">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </dialog>

  <dialog id="noteDialog">
    <form method="dialog">
      <h3>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°</h3>
      <div class="field">
        <label for="noteTitle">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input id="noteTitle" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢, To‚ÄëDo, ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå" />
      </div>
      <div class="field">
        <label for="noteBody">‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</label>
        <textarea id="noteBody" rows="8" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‚Ä¶"></textarea>
      </div>
      <div class="field">
        <label for="noteTags">‡πÅ‡∏ó‡πá‡∏Å (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ ‡∏Ñ‡∏≠‡∏°‡∏°‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ)</label>
        <input id="noteTags" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏á‡∏≤‡∏ô, ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£, ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç" />
      </div>
      <div class="dialog-actions">
        <button class="btn" value="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn primary" value="ok">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </div>
    </form>
  </dialog>

  <dialog id="lockDialog">
    <form method="dialog">
      <h3>‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</h3>
      <div id="lockHint" class="field" style="margin-top:-6px;color:var(--muted)"></div>
      <div class="field">
        <label for="unlockPass">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
        <input id="unlockPass" type="password" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠" />
      </div>
      <div class="dialog-actions">
        <button class="btn" value="cancel">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
        <button class="btn primary" value="ok">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ</button>
      </div>
    </form>
  </dialog>

  <script>
  // ===== IndexedDB Helper =====
  const DB_NAME = 'filevault-db';
  const DB_VER  = 2; // v2: add file.tags index
  const STORES  = { categories:'categories', files:'files' };

  function openDB(){
    return new Promise((resolve, reject)=>{
      const req = indexedDB.open(DB_NAME, DB_VER);
      req.onupgradeneeded = (ev)=>{
        const db = ev.target.result;
        if(!db.objectStoreNames.contains(STORES.categories)){
          const s = db.createObjectStore(STORES.categories, { keyPath:'id' });
          s.createIndex('name','name',{unique:false});
        }
        let fStore;
        if(!db.objectStoreNames.contains(STORES.files)){
          fStore = db.createObjectStore(STORES.files, { keyPath:'id' });
          fStore.createIndex('categoryId','categoryId',{unique:false});
          fStore.createIndex('name','name',{unique:false});
          fStore.createIndex('tags','tags',{unique:false, multiEntry:true});
        }else{
          fStore = req.transaction.objectStore(STORES.files);
          if(!fStore.indexNames.contains('tags')){
            fStore.createIndex('tags','tags',{unique:false, multiEntry:true});
          }
        }
      };
      req.onsuccess = ()=> resolve(req.result);
      req.onerror = ()=> reject(req.error);
    });
  }

  function tx(db, store, mode='readonly'){ return db.transaction(store, mode).objectStore(store); }
  const uid = ()=>'id-'+crypto.randomUUID();

  // Crypto utils
  async function sha256(str){
    const enc = new TextEncoder().encode(str);
    const buf = await crypto.subtle.digest('SHA-256', enc);
    return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,'0')).join('');
  }

  // ===== State =====
  const state = { db:null, cats:[], currentCat:null, search:'', activeTag:'', unlocked:{} };

  // ===== Category CRUD =====
  async function listCats(){
    const store = tx(state.db, STORES.categories);
    return new Promise((res, rej)=>{
      const r = store.getAll(); r.onsuccess=()=>res(r.result||[]); r.onerror=()=>rej(r.error);
    });
  }
  async function addCat(name, lock){
    const cat = { id:uid(), name, createdAt:Date.now(), ...(lock?{lock}: {}) };
    await new Promise((res, rej)=>{ const r = tx(state.db, STORES.categories, 'readwrite').add(cat); r.onsuccess=res; r.onerror=()=>rej(r.error); });
    return cat;
  }
  async function updateCat(id, patch){
    const store = tx(state.db, STORES.categories, 'readwrite');
    const cat = await new Promise((res, rej)=>{ const r = store.get(id); r.onsuccess=()=>res(r.result); r.onerror=()=>rej(r.error); });
    Object.assign(cat, patch);
    await new Promise((res, rej)=>{ const r = store.put(cat); r.onsuccess=res; r.onerror=()=>rej(r.error); });
  }
  async function removeCat(id){
    const fStore = tx(state.db, STORES.files, 'readwrite');
    await new Promise((res, rej)=>{
      const idx = fStore.index('categoryId').openCursor(IDBKeyRange.only(id));
      idx.onsuccess = (e)=>{ const cur = e.target.result; if(cur){ cur.delete(); cur.continue(); } else res(); };
      idx.onerror = ()=>rej(idx.error);
    });
    await new Promise((res, rej)=>{ const r = tx(state.db, STORES.categories, 'readwrite').delete(id); r.onsuccess=res; r.onerror=()=>rej(r.error); });
  }

  // ===== Files CRUD =====
  async function addFile({categoryId, name, type, size, blob, noteBody=null, tags=[]}){
    const file = { id:uid(), categoryId, name, type, size, createdAt:Date.now(), updatedAt:Date.now(), noteBody, isNote: !!noteBody, tags: Array.from(new Set(tags)).filter(Boolean) };
    if(blob) file.blob = blob; // store Blob directly
    await new Promise((res, rej)=>{ const r = tx(state.db, STORES.files, 'readwrite').add(file); r.onsuccess=res; r.onerror=()=>rej(r.error); });
    return file;
  }
  async function listFiles(categoryId, search='', tagFilter=''){
    const store = tx(state.db, STORES.files);
    return new Promise((res, rej)=>{
      const results = [];
      const idx = store.index('categoryId').openCursor(IDBKeyRange.only(categoryId));
      const q = (search||'').toLowerCase();
      idx.onsuccess = (e)=>{
        const cur = e.target.result;
        if(cur){
          const v = cur.value;
          if(!Array.isArray(v.tags)) v.tags = [];
          const matchText = !q || v.name.toLowerCase().includes(q) || (v.isNote && v.noteBody && v.noteBody.toLowerCase().includes(q)) || v.tags.some(t=>t.toLowerCase().includes(q.replace(/^#/,'')));
          const matchTag  = !tagFilter || v.tags.includes(tagFilter);
          if(matchText && matchTag) results.push(v);
          cur.continue();
        }else res(results.sort((a,b)=>b.updatedAt-a.updatedAt));
      };
      idx.onerror = ()=>rej(idx.error);
    });
  }
  async function listAllTags(categoryId){
    const store = tx(state.db, STORES.files);
    const set = new Set();
    return new Promise((res, rej)=>{
      const idx = store.index('categoryId').openCursor(IDBKeyRange.only(categoryId));
      idx.onsuccess = (e)=>{ const cur = e.target.result; if(cur){ const v=cur.value; (v.tags||[]).forEach(t=>set.add(t)); cur.continue(); } else res(Array.from(set).sort()); };
      idx.onerror = ()=>rej(idx.error);
    });
  }
  async function getFile(id){
    return new Promise((res, rej)=>{ const r = tx(state.db, STORES.files).get(id); r.onsuccess=()=>res(r.result); r.onerror=()=>rej(r.error);});
  }
  async function updateFile(id, patch){
    const store = tx(state.db, STORES.files, 'readwrite');
    const file = await new Promise((res, rej)=>{ const r = store.get(id); r.onsuccess=()=>res(r.result); r.onerror=()=>rej(r.error); });
    Object.assign(file, patch, {updatedAt:Date.now()});
    if(!Array.isArray(file.tags)) file.tags=[];
    file.tags = Array.from(new Set(file.tags));
    await new Promise((res, rej)=>{ const r = store.put(file); r.onsuccess=res; r.onerror=()=>rej(r.error); });
  }
  async function removeFile(id){
    await new Promise((res, rej)=>{ const r = tx(state.db, STORES.files, 'readwrite').delete(id); r.onsuccess=res; r.onerror=()=>rej(r.error); });
  }

  // ===== UI Logic =====
  const catListEl = document.getElementById('catList');
  const fileGridEl = document.getElementById('fileGrid');
  const emptyStateEl = document.getElementById('emptyState');
  const currentCatBadge = document.getElementById('currentCatBadge');
  const tagFiltersEl = document.getElementById('tagFilters');

  function iconFor(name, isNote){
    if(isNote) return 'üìù';
    const ext = (name.split('.').pop()||'').toLowerCase();
    if(['png','jpg','jpeg','gif','webp','svg'].includes(ext)) return 'üñºÔ∏è';
    if(['pdf'].includes(ext)) return 'üìï';
    if(['zip','rar','7z'].includes(ext)) return 'üóúÔ∏è';
    if(['txt','md','log'].includes(ext)) return 'üìÑ';
    if(['doc','docx'].includes(ext)) return 'üìò';
    if(['xls','xlsx','csv'].includes(ext)) return 'üìä';
    if(['ppt','pptx'].includes(ext)) return 'üìà';
    return 'üì¶';
  }

  function fmtBytes(n){ if(n==null) return '-'; const u=['B','KB','MB','GB','TB']; let i=0; while(n>=1024 && i<u.length-1){n/=1024;i++;} return n.toFixed(n<10?2:0)+' '+u[i]; }
  function fmtDate(t){ const d = new Date(t); return d.toLocaleString(); }

  function isLocked(cat){ return !!(cat.lock && !state.unlocked[cat.id]); }

  async function renderCats(){
    state.cats = await listCats();
    if(state.cats.length===0){
      const def = await addCat('‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ');
      state.cats = [def];
      state.currentCat = def.id;
    }
    if(!state.currentCat) state.currentCat = state.cats[0].id;

    catListEl.innerHTML = '';
    for(const c of state.cats){
      const el = document.createElement('div'); el.className='cat' + (state.currentCat===c.id?' active':''); el.setAttribute('role','option'); el.tabIndex=0;
      const count = await listFiles(c.id, '');
      const lockIcon = c.lock ? (state.unlocked[c.id] ? 'üîì' : 'üîí') : '';
      el.innerHTML = `<div class="name">${lockIcon} ${c.name}</div><div class="count">${count.length} ‡πÑ‡∏ü‡∏•‡πå</div>
        <div class="actions">
          <button class="icon-btn" title="‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠/‡∏£‡∏´‡∏±‡∏™" data-act="rename">‚úé</button>
          <button class="icon-btn" title="‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ" data-act="delete">üóëÔ∏è</button>
        </div>`;
      el.addEventListener('click', async (e)=>{ const btn = e.target.closest('button'); const act = btn?.dataset?.act;
        if(act==='rename'){ onRenameCat(c); e.stopPropagation(); return; }
        if(act==='delete'){ onDeleteCat(c); e.stopPropagation(); return; }
        state.currentCat = c.id; await renderCats(); await renderFiles();
      });
      catListEl.appendChild(el);
    }
    const cur = state.cats.find(x=>x.id===state.currentCat);
    currentCatBadge.textContent = '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ' + (cur?cur.name:'-');
  }

  async function renderTagFilters(){
    tagFiltersEl.innerHTML='';
    const cur = state.cats.find(x=>x.id===state.currentCat);
    if(!cur) return;
    const tags = await listAllTags(cur.id);
    if(tags.length===0){ tagFiltersEl.innerHTML = '<span class="chip" style="opacity:.6">(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ó‡πá‡∏Å)</span>'; return; }
    for(const t of tags){
      const chip = document.createElement('span'); chip.className='chip tag' + (state.activeTag===t?' active':''); chip.textContent = '#'+t;
      chip.addEventListener('click', ()=>{ state.activeTag = (state.activeTag===t?'':t); renderFiles(); renderTagFilters(); });
      tagFiltersEl.appendChild(chip);
    }
  }

  async function renderFiles(){
    const curCat = state.cats.find(x=>x.id===state.currentCat);
    if(!curCat){ fileGridEl.innerHTML=''; emptyStateEl.hidden=false; return; }

    if(isLocked(curCat)){
      fileGridEl.innerHTML = `<div class="empty">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏•‡πá‡∏≠‡∏Ñ ${curCat.lock?.hint?`<div style='margin-top:6px;color:var(--muted)'>‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ: ${curCat.lock.hint}</div>`:''}<div style="margin-top:12px"><button class="btn primary" id="unlockBtn">‡∏õ‡∏•‡∏î‡∏•‡πá‡∏≠‡∏Ñ</button></div></div>`;
      emptyStateEl.hidden = true;
      document.getElementById('unlockBtn').onclick = ()=> unlockCategory(curCat);
      return;
    }

    const items = await listFiles(state.currentCat, state.search, state.activeTag);
    fileGridEl.innerHTML='';
    emptyStateEl.hidden = items.length>0;
    for(const f of items){
      const card = document.createElement('div'); card.className='file';
      const tags = (f.tags||[]).map(t=>`<span class="tagchip">#${t}</span>`).join('');
      card.innerHTML = `
        <div class="thumb">${iconFor(f.name, f.isNote)}</div>
        <div class="meta">
          <div class="name" title="${f.name}">${f.name}</div>
          <div class="sub">${f.isNote? '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°' : (f.type||'-')} ‚Ä¢ ${fmtBytes(f.size)} ‚Ä¢ ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î ${fmtDate(f.updatedAt)}</div>
          ${(f.isNote? `<div class="sub" style="margin-top:6px; white-space:pre-wrap">${(f.noteBody||'').slice(0,200)}</div>`:'')}
          <div class="tags">${tags}</div>
        </div>
        <div class="file-actions">
          ${f.isNote? '<button class="btn" data-act="edit">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>' : '<button class="btn" data-act="download">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î</button>'}
          <button class="btn" data-act="tags">‡πÅ‡∏ó‡πá‡∏Å</button>
          <button class="btn" data-act="rename">‡∏ä‡∏∑‡πà‡∏≠</button>
          <button class="btn" data-act="move">‡∏¢‡πâ‡∏≤‡∏¢</button>
          <button class="btn danger" data-act="delete">‡∏•‡∏ö</button>
        </div>`;
      card.querySelectorAll('button').forEach(b=>{ b.addEventListener('click', async (e)=>{ const act = e.currentTarget.dataset.act;
          if(act==='download') return onDownload(f);
          if(act==='rename') return onRenameFile(f);
          if(act==='move') return onMoveFile(f);
          if(act==='delete') return onDeleteFile(f);
          if(act==='edit') return onEditNote(f);
          if(act==='tags') return onEditTags(f);
        })
      })
      fileGridEl.appendChild(card);
    }
  }

  // ===== Actions =====
  async function onAddCategory(){
    const dlg = document.getElementById('catDialog');
    const input = document.getElementById('catName');
    const enable = document.getElementById('catLockEnable');
    const row = document.getElementById('catLockRow');
    const pass = document.getElementById('catPassword');
    const hint = document.getElementById('catHint');
    input.value=''; enable.checked=false; pass.value=''; hint.value=''; row.style.display='none';
    enable.onchange = ()=>{ row.style.display = enable.checked ? '' : 'none'; };
    document.getElementById('catDialogTitle').textContent='‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏´‡∏°‡πà';
    dlg.showModal();
    const done = await new Promise(r=> dlg.addEventListener('close', ()=>r(dlg.returnValue), {once:true}));
    if(done==='ok'){
      const name = input.value.trim(); if(!name) return;
      let lock=null; if(enable.checked && pass.value){ lock={ hash: await sha256(pass.value), hint: hint.value.trim()||'' } }
      const c = await addCat(name, lock); state.currentCat = c.id; renderCats(); renderFiles();
    }
  }

  async function onRenameCat(cat){
    const dlg = document.getElementById('catDialog');
    const input = document.getElementById('catName');
    const enable = document.getElementById('catLockEnable');
    const row = document.getElementById('catLockRow');
    const pass = document.getElementById('catPassword');
    const hint = document.getElementById('catHint');

    input.value = cat.name;
    enable.checked = !!cat.lock; row.style.display = enable.checked?'':'none';
    enable.onchange = ()=>{ row.style.display = enable.checked ? '' : 'none'; };
    pass.value=''; hint.value = cat.lock?.hint||'';
    document.getElementById('catDialogTitle').textContent='‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠';
    dlg.showModal();
    const done = await new Promise(r=> dlg.addEventListener('close', ()=>r(dlg.returnValue), {once:true}));
    if(done==='ok'){
      const name = input.value.trim(); if(!name) return;
      let patch = { name };
      if(enable.checked){
        const newHash = pass.value ? await sha256(pass.value) : (cat.lock?.hash||null);
        patch.lock = { hash:newHash, hint: hint.value.trim()||'' };
      }else{
        patch.lock = null; delete state.unlocked[cat.id];
      }
      await updateCat(cat.id, patch); await renderCats(); await renderFiles();
    }
  }

  async function onDeleteCat(cat){
    if(!confirm(`‡∏•‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ ‚Äú${cat.name}‚Äù ‡πÅ‡∏•‡∏∞‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
    await removeCat(cat.id);
    state.currentCat = (state.cats.find(x=>x.id!==cat.id)||{}).id || null;
    await renderCats(); await renderFiles();
  }

  async function onAddFiles(files){
    if(!state.currentCat) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠');
    for(const file of files){
      const buf = await file.arrayBuffer();
      const blob = new Blob([buf], {type:file.type||'application/octet-stream'});
      await addFile({categoryId:state.currentCat, name:file.name, type:file.type, size:file.size, blob});
    }
    await renderFiles(); await renderTagFilters();
  }
  async function onDownload(f){
    const full = await getFile(f.id);
    const url = URL.createObjectURL(full.blob || new Blob([full.noteBody||''], {type:'text/plain'}));
    const a = document.createElement('a'); a.href=url; a.download=full.name; document.body.appendChild(a); a.click(); a.remove();
    setTimeout(()=>URL.revokeObjectURL(url), 1500);
  }
  async function onRenameFile(f){
    const name = prompt('‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏õ‡πá‡∏ô‚Ä¶', f.name); if(!name) return;
    await updateFile(f.id, {name}); renderFiles();
  }
  async function onMoveFile(f){
    const options = state.cats.map(c=>`${c.id}::${c.name}`).join('\n');
    const pick = prompt('‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (‡∏û‡∏¥‡∏°‡∏û‡πå ID ‡πÅ‡∏•‡πâ‡∏ß Enter):\n' + options + '\n\n‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡πâ‡∏≤ :: ‡πÄ‡∏õ‡πá‡∏ô ID', state.currentCat);
    if(!pick) return; const target = state.cats.find(c=>c.id===pick.trim()); if(!target) return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠');
    await updateFile(f.id, {categoryId:target.id}); renderFiles(); renderCats();
  }
  async function onDeleteFile(f){
    if(!confirm(`‡∏•‡∏ö ‚Äú${f.name}‚Äù ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) return;
    await removeFile(f.id); renderFiles(); renderCats(); await renderTagFilters();
  }

  async function onNewNote(){
    if(!state.currentCat) return alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠');
    const dlg = document.getElementById('noteDialog');
    const title = document.getElementById('noteTitle');
    const body = document.getElementById('noteBody');
    const tags = document.getElementById('noteTags');
    title.value=''; body.value=''; tags.value='';
    dlg.showModal();
    const done = await new Promise(r=> dlg.addEventListener('close', ()=>r(dlg.returnValue), {once:true}));
    if(done==='ok'){
      const nm = (title.value.trim()||'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏´‡∏°‡πà') + '.txt';
      const tgs = parseTags(tags.value);
      await addFile({categoryId:state.currentCat, name:nm, type:'text/plain', size:(body.value||'').length, blob:null, noteBody: body.value, tags:tgs});
      renderFiles(); await renderTagFilters();
    }
  }
  async function onEditNote(f){
    const dlg = document.getElementById('noteDialog');
    const title = document.getElementById('noteTitle');
    const body = document.getElementById('noteBody');
    const tags = document.getElementById('noteTags');
    title.value = f.name.replace(/\.txt$/,'');
    body.value = f.noteBody||'';
    tags.value = (f.tags||[]).join(', ');
    dlg.showModal();
    const done = await new Promise(r=> dlg.addEventListener('close', ()=>r(dlg.returnValue), {once:true}));
    if(done==='ok'){
      await updateFile(f.id, {name:(title.value.trim()||'‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å')+'.txt', noteBody: body.value, size: body.value.length, tags: parseTags(tags.value)});
      renderFiles(); await renderTagFilters();
    }
  }

  function parseTags(s){
    return (s||'').split(/[ ,]+/).map(x=>x.trim()).filter(Boolean).map(x=>x.replace(/^#/,'')).slice(0,20);
  }
  async function onEditTags(f){
    const cur = (f.tags||[]).join(', ');
    const s = prompt('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÅ‡∏ó‡πá‡∏Å (‡∏Ñ‡∏±‡πà‡∏ô‡∏î‡πâ‡∏ß‡∏¢ , ‡∏´‡∏£‡∏∑‡∏≠ ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ)\n‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏á‡∏≤‡∏ô, ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£, ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç', cur);
    if(s==null) return;
    await updateFile(f.id, {tags: parseTags(s)}); renderFiles(); await renderTagFilters();
  }

  // ===== Backup / Restore =====
  async function exportAll(){
    const cats = await listCats();
    const files = await new Promise((res,rej)=>{ const r = tx(state.db, STORES.files).getAll(); r.onsuccess=()=>res(r.result||[]); r.onerror=()=>rej(r.error); });
    async function blobToB64(b){ if(!b) return null; const buf = await b.arrayBuffer(); let bin=''; const bytes=new Uint8Array(buf); for(let i=0;i<bytes.length;i++) bin+=String.fromCharCode(bytes[i]); return btoa(bin); }
    const filesOut = [];
    for(const f of files){ filesOut.push({...f, blob: f.blob ? {type:f.blob.type, data: await blobToB64(f.blob)} : null}); }
    const payload = { schema:'filevault-v1', exportedAt: Date.now(), cats, files: filesOut };
    const json = new Blob([JSON.stringify(payload)], {type:'application/json'});
    const url = URL.createObjectURL(json); const a=document.createElement('a'); a.href=url; a.download='filevault-backup.json'; document.body.appendChild(a); a.click(); a.remove(); setTimeout(()=>URL.revokeObjectURL(url),1500);
  }

  async function importAll(file){
    const text = await file.text();
    const payload = JSON.parse(text);
    if(payload.schema!=='filevault-v1') return alert('‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');

    for(const c of payload.cats||[]){ await new Promise((res,rej)=>{ const r = tx(state.db, STORES.categories, 'readwrite').put(c); r.onsuccess=res; r.onerror=()=>rej(r.error); }); }
    for(const f of (payload.files||[])){
      let blob = null; if(f.blob && f.blob.data){ const bin = atob(f.blob.data); const bytes = new Uint8Array(bin.length); for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i); blob=new Blob([bytes], {type: f.blob.type||'application/octet-stream'}); }
      const rec = {...f}; if(blob) rec.blob = blob; if(!Array.isArray(rec.tags)) rec.tags=[];
      delete rec.blob?.data; delete rec.blob?.type;
      await new Promise((res,rej)=>{ const r = tx(state.db, STORES.files, 'readwrite').put(rec); r.onsuccess=res; r.onerror=()=>rej(r.error); });
    }
    await renderCats(); await renderFiles(); await renderTagFilters();
  }

  // ===== Lock/Unlock =====
  async function unlockCategory(cat){
    const dlg = document.getElementById('lockDialog');
    const hint = document.getElementById('lockHint');
    const pass = document.getElementById('unlockPass');
    hint.textContent = cat.lock?.hint ? '‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ: '+cat.lock.hint : '';
    pass.value='';
    dlg.showModal();
    const done = await new Promise(r=> dlg.addEventListener('close', ()=>r(dlg.returnValue), {once:true}));
    if(done==='ok'){
      const hash = await sha256(pass.value);
      if(hash===cat.lock.hash){ state.unlocked[cat.id]=true; await renderCats(); await renderFiles(); }
      else alert('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
    }
  }

  document.getElementById('lockToggleBtn').addEventListener('click', ()=>{
    const cur = state.cats.find(c=>c.id===state.currentCat);
    if(!cur || !cur.lock) return alert('‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏´‡∏±‡∏™');
    delete state.unlocked[cur.id]; renderCats(); renderFiles();
  });

  // ===== Event Wiring =====
  document.getElementById('addCatBtn').addEventListener('click', onAddCategory);
  document.getElementById('renameCatBtn').addEventListener('click', async ()=>{
    const cur = state.cats.find(c=>c.id===state.currentCat); if(cur) onRenameCat(cur);
  });
  document.getElementById('deleteCatBtn').addEventListener('click', async ()=>{
    const cur = state.cats.find(c=>c.id===state.currentCat); if(cur) onDeleteCat(cur);
  });

  const fileInput = document.getElementById('fileInput');
  document.getElementById('addFilesBtn').addEventListener('click', ()=> fileInput.click());
  fileInput.addEventListener('change', (e)=> onAddFiles(e.target.files));
  document.getElementById('newNoteBtn').addEventListener('click', onNewNote);

  document.getElementById('exportBtn').addEventListener('click', exportAll);
  document.getElementById('importInput').addEventListener('change', (e)=>{ const f=e.target.files[0]; if(f) importAll(f); });

  const searchInput = document.getElementById('searchInput');
  searchInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ state.search = searchInput.value.trim(); renderFiles(); }});
  document.getElementById('clearSearch').addEventListener('click', ()=>{ state.search=''; searchInput.value=''; renderFiles(); });
  document.getElementById('clearTagFilterBtn').addEventListener('click', ()=>{ state.activeTag=''; renderFiles(); renderTagFilters(); });

  // Drag & Drop
  const dropZone = document.getElementById('dropZone');
  ;['dragenter','dragover'].forEach(ev=> dropZone.addEventListener(ev, (e)=>{ e.preventDefault(); dropZone.style.outline='2px dashed #6ea8ff'; dropZone.style.outlineOffset='-10px'; }));
  ;['dragleave','drop'].forEach(ev=> dropZone.addEventListener(ev, (e)=>{ e.preventDefault(); dropZone.style.outline=''; dropZone.style.outlineOffset=''; }));
  dropZone.addEventListener('drop', (e)=>{ const files = [...(e.dataTransfer?.files||[])]; if(files.length) onAddFiles(files); });

  // ===== Init =====
  (async function init(){
    state.db = await openDB();
    await renderCats();
    await renderFiles();
    await renderTagFilters();
  })();

  // ===== Note on security =====
  // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÉ‡∏ä‡πâ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö ‚Äú‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡πÉ‡∏ô‡πÅ‡∏≠‡∏õ‚Äù ‡πÇ‡∏î‡∏¢‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÅ‡∏Æ‡∏ä (SHA-256) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  // ‡πÑ‡∏ü‡∏•‡πå‡πÉ‡∏ô IndexedDB ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™ ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏ü‡∏•‡πå‡∏à‡∏£‡∏¥‡∏á (AES-GCM) ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á‡πÑ‡∏î‡πâ
  </script>
</body>
</html>
